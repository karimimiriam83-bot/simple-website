<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Miriam's Curtains & Fashion â€” Full E-Commerce</title>
  <meta name="description" content="Miriam's Curtains & Fashion â€” curtains, bedding, baby clothes. Order via WhatsApp or online.">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- AOS (animations) -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

  <style>
    :root{
      --purple:#5b2b9d; --gold:#d4af37; --bg:#f7f5ff; --muted:#eae6f8; --text:#222; --max-w:1100px;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:"Poppins",system-ui,Arial; background:var(--bg); color:var(--text);}
    header{background:var(--purple); color:#fff; padding:18px; position:relative; text-align:center;}
    #menu-btn{position:absolute; left:14px; top:14px; background:#111; color:var(--gold); border:0; padding:8px 12px; border-radius:6px; cursor:pointer;}
    #logo{width:84px;border-radius:8px; vertical-align:middle}
    nav{background:#111; display:flex; justify-content:center; gap:12px; padding:8px; position:sticky; top:0; z-index:10;}
    nav a{color:var(--gold); font-weight:700; text-decoration:none}
    .banner{background:url('https://i.imgur.com/8s1YfNI.jpeg') center/cover;height:200px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;text-shadow:2px 2px 8px rgba(0,0,0,0.5)}
    .container{max-width:var(--max-w); margin:0 auto; padding:20px;}
    .about{background:#fff;padding:16px;border-radius:10px;border:1px solid var(--muted);margin-bottom:18px}
    .controls{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:12px}
    .search input{padding:10px;border-radius:8px;border:1px solid #eee;width:100%;min-width:220px}
    .grid{display:grid;gap:18px; grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
    .card{background:#fff;border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;flex-direction:column}
    .card img{width:100%;height:160px;object-fit:cover;border-radius:8px}
    .card h3{margin:8px 0 6px;font-size:16px}
    .price{color:green;font-weight:700;margin-top:auto}
    footer{background:#111;color:#fff;padding:18px;text-align:center;margin-top:24px}
    .whatsapp-float{position:fixed;right:16px;bottom:16px;background:#25d366;color:#fff;padding:14px;border-radius:50%;z-index:2000;text-decoration:none}
    #cart-drawer{position:fixed;right:-420px;top:0;width:420px;height:100%;background:#fff;box-shadow:-8px 0 24px rgba(0,0,0,0.2);z-index:1500;padding:16px;transition:right .28s}
    .cart-item{display:flex;gap:10px;align-items:center;margin-bottom:12px}
    .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:6px}
    .admin-panel{background:#fff8e6;padding:12px;border-radius:8px;border:1px solid #ffe8b5;margin-top:14px}
    .admin-panel input,.admin-panel select{width:100%;padding:8px;margin-top:8px;border-radius:6px;border:1px solid #ddd}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:var(--purple);color:#fff}
    .btn-gold{background:var(--gold);color:#111}
    #back-to-top{position:fixed;right:16px;bottom:86px;background:var(--purple);color:var(--gold);border:0;width:44px;height:44px;border-radius:50%;display:none;z-index:1600}
    @media(max-width:600px){ .controls{flex-direction:column;align-items:stretch} #cart-drawer{width:100%} }
  </style>
</head>
<body>

  <!-- SIDEBAR (simple anchor list) -->
  <div id="sidebar" style="position:fixed;left:-300px;top:0;width:280px;height:100%;background:#0f0f10;color:#fff;padding-top:56px;z-index:1400;transition:left .32s;">
    <button id="closeSidebar" style="position:absolute;right:12px;top:8px;background:none;color:var(--gold);font-size:22px;border:0;cursor:pointer">&times;</button>
    <nav style="display:block;padding:12px">
      <a href="#products" style="display:block;padding:10px;color:var(--gold)">All Products</a>
      <a href="#women-fashion" style="display:block;padding:10px;color:var(--gold)">Women Fashion</a>
      <a href="#men-fashion" style="display:block;padding:10px;color:var(--gold)">Men Fashion</a>
      <a href="#baby-products" style="display:block;padding:10px;color:var(--gold)">Baby Products</a>
      <a href="#home-decor" style="display:block;padding:10px;color:var(--gold)">Home Decor</a>
      <a href="#toilet-products" style="display:block;padding:10px;color:var(--gold)">Toilet Products</a>
      <a href="#modern-bedding" style="display:block;padding:10px;color:var(--gold)">Modern Bedding</a>
      <a href="#contact" style="display:block;padding:10px;color:var(--gold)">Contact</a>
    </nav>
  </div>

  <div id="overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:1380"></div>

  <header>
    <button id="menu-btn" aria-label="Open menu">â˜° Menu</button>
    <div style="display:flex;align-items:center;justify-content:center;gap:12px">
      <img id="logo" src="https://i.imgur.com/bVR7KqS.png" alt="logo">
      <div>
        <div style="font-weight:700;font-size:20px">Miriamâ€™s Curtains & Fashion</div>
        <div style="font-size:13px;color:#ffe8b5">Curtains â€¢ Beddings â€¢ Bags â€¢ Baby Clothes â€¢ Tailoring</div>
      </div>
    </div>
  </header>

  <nav style="background:#111;position:sticky;top:0;z-index:20;text-align:center;padding:10px">
    <a href="#products" style="color:var(--gold);margin:0 10px">Products</a>
    <a href="#women-fashion" style="color:var(--gold);margin:0 10px">Women</a>
    <a href="#men-fashion" style="color:var(--gold);margin:0 10px">Men</a>
    <a href="#baby-products" style="color:var(--gold);margin:0 10px">Baby</a>
    <a href="#home-decor" style="color:var(--gold);margin:0 10px">Home</a>
    <a href="#modern-bedding" style="color:var(--gold);margin:0 10px">Bedding</a>
    <a href="#contact" style="color:var(--gold);margin:0 10px">Contact</a>
  </nav>

  <div class="banner"><div class="container">Beautiful â€¢ Modern â€¢ Affordable</div></div>

  <main class="container">
    <section class="about">
      <h2>About Miriam's Curtains & Fashion</h2>
      <p>
        Miriamâ€™s Curtains & Fashion is a family-run Kenyan shop offering custom-tailored curtains, bedding, baby clothing and accessories.
        Order online or via WhatsApp. Admins can manage products here (you need an admin account â€” instructions below).
      </p>
    </section>

    <!-- Controls -->
    <div class="controls">
      <div class="search" style="flex:1">
        <input id="searchInput" placeholder="Search products by name or category">
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="openCart" class="btn btn-gold">Cart (<span id="cartCount">0</span>)</button>
        <button id="signInBtn" class="btn btn-primary">Admin Sign In</button>
      </div>
    </div>

    <!-- Featured / product grids (populated dynamically) -->
    <section id="products">
      <h2>Featured Products</h2>
      <div id="gridFeatured" class="grid" aria-live="polite"></div>
    </section>

    <section id="women-fashion"><h2>Women Fashion</h2><div id="gridWomen" class="grid"></div></section>
    <section id="men-fashion"><h2>Men Fashion</h2><div id="gridMen" class="grid"></div></section>
    <section id="baby-products"><h2>Baby Products</h2><div id="gridBaby" class="grid"></div></section>
    <section id="home-decor"><h2>Home Decor</h2><div id="gridHome" class="grid"></div></section>
    <section id="toilet-products"><h2>Toilet Products</h2><div id="gridToilet" class="grid"></div></section>
    <section id="modern-bedding"><h2>Modern Bedding</h2><div id="gridBedding" class="grid"></div></section>

    <!-- Contact & Admin area -->
    <section id="contact">
      <h2>Contact Us</h2>
      <form id="contactForm" action="mailto:karimimiriam83@gmail.com" method="post" enctype="text/plain">
        <input name="name" type="text" placeholder="Your Name" required>
        <input name="email" type="email" placeholder="Email Address" required>
        <textarea name="message" rows="4" placeholder="Message" required></textarea>
        <button type="submit" class="btn btn-primary">Send Message</button>
      </form>

      <div id="adminArea" style="margin-top:18px;display:none">
        <div class="admin-panel">
          <strong>Admin panel</strong>
          <div style="margin-top:8px">
            <input id="adm_name" placeholder="Product name">
            <input id="adm_price" placeholder="Price (KSh)">
            <select id="adm_category">
              <option value="women">Women</option>
              <option value="men">Men</option>
              <option value="baby">Baby</option>
              <option value="home">Home</option>
              <option value="toilet">Toilet</option>
              <option value="bedding">Bedding</option>
            </select>
            <input id="adm_image" placeholder="Choose local image file" type="file" accept="image/*">
            <div style="display:flex;gap:8px;margin-top:10px">
              <button id="adm_add" class="btn btn-gold">Add Product</button>
              <button id="adm_signOut" class="btn">Sign Out</button>
            </div>
            <div style="font-size:12px;margin-top:8px;color:#444">Products created in admin are stored in Firestore and images uploaded to Firebase Storage.</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Cart Drawer -->
  <div id="cart-drawer" aria-hidden="true">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <div><strong>Total: KSh <span id="cartTotal">0</span></strong></div>
    <div style="margin-top:12px;display:flex;gap:8px">
      <button id="cartCheckout" class="btn btn-primary" style="flex:1">Checkout (WhatsApp)</button>
      <button id="cartClear" class="btn" style="padding:8px">Clear</button>
    </div>
  </div>

  <a class="whatsapp-float" href="https://wa.me/254795286190" target="_blank" rel="noopener" title="Chat on WhatsApp">ðŸ’¬</a>
  <button id="back-to-top" aria-label="Back to top">â¬†</button>

  <footer>
    <p>ðŸ“ž Call: <a href="tel:0795286190">0795286190</a> â€¢ ðŸ“§ <a href="mailto:karimimiriam83@gmail.com">karimimiriam83@gmail.com</a></p>
    <p style="font-size:12px;color:#ccc">Â© 2025 Miriamâ€™s Curtains & Fashion</p>
  </footer>

  <!-- Firebase SDKs (compat mode for simpler code) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

  <script>
    AOS.init({duration:700, once:true});

    // ====== FIREBASE CONFIG - REPLACE THIS WITH YOUR PROJECT CONFIG ======
    // Go to Firebase Console -> Project Settings -> SDK Snippet -> Config
    // Replace below object exactly with your config (apiKey, authDomain, etc.)
    const firebaseConfig = {
      apiKey: "REPLACE_WITH_YOUR_API_KEY",
      authDomain: "REPLACE_WITH_YOUR_AUTH_DOMAIN",
      projectId: "REPLACE_WITH_YOUR_PROJECT_ID",
      storageBucket: "REPLACE_WITH_YOUR_STORAGE_BUCKET",
      messagingSenderId: "REPLACE_WITH_MESSAGING_SENDER_ID",
      appId: "REPLACE_WITH_YOUR_APP_ID",
      measurementId: "REPLACE_WITH_YOUR_MEASUREMENT_ID"
    };
    // ===================================================================

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // UI elements
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const menuBtn = document.getElementById('menu-btn');
    const closeSidebarBtn = document.getElementById('closeSidebar');

    menuBtn.addEventListener('click', ()=>{ sidebar.style.left = '0'; overlay.style.display = 'block'; });
    closeSidebarBtn.addEventListener('click', ()=>{ sidebar.style.left = '-300px'; overlay.style.display = 'none'; });
    overlay.addEventListener('click', ()=>{ sidebar.style.left = '-300px'; overlay.style.display = 'none'; });

    // BACK TO TOP
    const backBtn = document.getElementById('back-to-top');
    window.addEventListener('scroll', ()=> backBtn.style.display = (window.scrollY>300 ? 'block' : 'none'));
    backBtn.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

    // CART (localStorage)
    let CART = JSON.parse(localStorage.getItem('miriam_cart') || '[]');
    function saveCart(){ localStorage.setItem('miriam_cart', JSON.stringify(CART)); renderCart(); }
    function addToCart(id){
      const p = window.PRODUCT_CACHE.find(x=>x.id===id);
      if(!p) return alert('Product not found');
      const found = CART.find(i=>i.id===id);
      if(found) found.qty++;
      else CART.push({id:p.id,name:p.name,price:p.price,image:p.image,qty:1});
      saveCart();
      alert(p.name + ' added to cart');
    }
    function renderCart(){
      document.getElementById('cartCount').textContent = CART.reduce((s,i)=>s+i.qty,0);
      const list = document.getElementById('cartItems');
      list.innerHTML = '';
      let total = 0;
      CART.forEach(item=>{
        total += item.price * item.qty;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `<img src="${item.image}" alt="${item.name}"><div style="flex:1"><strong>${item.name}</strong><div>KSh ${item.price} x ${item.qty}</div></div>
          <div><button class="btn" data-action="dec" data-id="${item.id}">âˆ’</button><button class="btn" data-action="inc" data-id="${item.id}">+</button></div>`;
        list.appendChild(div);
      });
      document.getElementById('cartTotal').textContent = total;
      // attach
      document.querySelectorAll('#cartItems [data-action]').forEach(b=>{
        b.addEventListener('click', (e)=>{
          const id = b.getAttribute('data-id'), action = b.getAttribute('data-action');
          const it = CART.find(x=>x.id===id);
          if(!it) return;
          if(action==='inc') it.qty++;
          if(action==='dec') it.qty--;
          CART = CART.filter(x=>x.qty>0);
          saveCart();
        });
      });
    }
    document.getElementById('openCart').addEventListener('click', ()=>{ document.getElementById('cart-drawer').style.right = '0'; });
    document.getElementById('cartClear').addEventListener('click', ()=>{ if(confirm('Clear cart?')){ CART = []; saveCart(); }});
    document.getElementById('cartCheckout').addEventListener('click', ()=> {
      if(CART.length===0) return alert('Your cart is empty');
      // Create Firestore order then open WhatsApp with message
      const now = new Date().toISOString();
      const order = { items: CART, total: CART.reduce((s,i)=>s+i.qty*i.price,0), createdAt: firebase.firestore.FieldValue.serverTimestamp() };
      db.collection('orders').add(order).then(docRef=>{
        // open WhatsApp with order summary (encode)
        let msg = `Order #${docRef.id}\n`;
        CART.forEach(i => msg += `- ${i.name} x${i.qty} = KSh ${i.price*i.qty}\n`);
        msg += `\nTotal: KSh ${order.total}`;
        window.open('https://wa.me/254795286190?text=' + encodeURIComponent(msg), '_blank');
        CART = []; saveCart();
        alert('Order saved. WhatsApp opened to place the order.');
      }).catch(err=>{
        console.error(err);
        alert('Failed to save order: ' + err.message);
      });
    });

    // PRODUCT: read from Firestore and render
    window.PRODUCT_CACHE = [];
    function productCard(p){
      return `
        <div class="card" data-id="${p.id}" data-aos="fade-up">
          <img src="${p.image}" alt="${p.name}">
          <h3>${p.name}</h3>
          <div class="price">KSh ${p.price}</div>
          <div style="margin-top:8px"><button class="btn btn-gold add-btn" data-id="${p.id}">Add to cart</button></div>
        </div>`;
    }

    function attachAddButtons(){
      document.querySelectorAll('.add-btn').forEach(btn=>{
        btn.onclick = ()=> addToCart(btn.getAttribute('data-id'));
      });
    }

    function renderProducts(list){
      // caches
      window.PRODUCT_CACHE = list;
      const f = document.getElementById('gridFeatured');
      const gw = document.getElementById('gridWomen');
      const gm = document.getElementById('gridMen');
      const gb = document.getElementById('gridBaby');
      const gh = document.getElementById('gridHome');
      const gt = document.getElementById('gridToilet');
      const gbd = document.getElementById('gridBedding');
      f.innerHTML = gw.innerHTML = gm.innerHTML = gb.innerHTML = gh.innerHTML = gt.innerHTML = gbd.innerHTML = '';
      list.forEach(p=>{
        if(p.featured) f.insertAdjacentHTML('beforeend', productCard(p));
        if(p.category==='women') gw.insertAdjacentHTML('beforeend', productCard(p));
        if(p.category==='men') gm.insertAdjacentHTML('beforeend', productCard(p));
        if(p.category==='baby') gb.insertAdjacentHTML('beforeend', productCard(p));
        if(p.category==='home') gh.insertAdjacentHTML('beforeend', productCard(p));
        if(p.category==='toilet') gt.insertAdjacentHTML('beforeend', productCard(p));
        if(p.category==='bedding') gbd.insertAdjacentHTML('beforeend', productCard(p));
      });
      attachAddButtons();
      AOS.refresh();
    }

    // Listen to Firestore products (real-time)
    db.collection('products').orderBy('createdAt','desc').onSnapshot(snapshot=>{
      const items = [];
      snapshot.forEach(doc=>{
        const data = doc.data();
        items.push({
          id: doc.id,
          name: data.name,
          price: data.price,
          image: data.image,
          category: data.category,
          featured: !!data.featured,
          createdAt: data.createdAt
        });
      });
      renderProducts(items);
    }, err => console.error('Products read failed', err));

    // SEARCH input
    document.getElementById('searchInput').addEventListener('input', function(){
      const q = this.value.trim().toLowerCase();
      document.querySelectorAll('.card').forEach(card=>{
        const txt = (card.querySelector('h3').textContent + ' ' + card.querySelector('img').alt).toLowerCase();
        card.style.display = txt.includes(q) ? '' : 'none';
      });
    });

    // ADMIN AUTH & PLAYER
    const signInBtn = document.getElementById('signInBtn');
    const adminArea = document.getElementById('adminArea');

    // Show simple email/password prompt for admin (first time create admin account via Firebase Console or call createUser)
    signInBtn.addEventListener('click', ()=>{
      const email = prompt('Admin email:');
      if(!email) return;
      const pass = prompt('Password: (keep it safe)');
      if(!pass) return;
      auth.signInWithEmailAndPassword(email, pass).catch(err=>{
        if(err.code === 'auth/user-not-found'){
          if(confirm('No user found. Create new admin account?')) {
            auth.createUserWithEmailAndPassword(email, pass).then(()=>alert('Admin account created.')).catch(e=>alert('Create failed: '+e.message));
          }
        } else alert('Sign-in failed: ' + err.message);
      });
    });

    auth.onAuthStateChanged(user=>{
      if(user){
        adminArea.style.display = 'block';
        signInBtn.style.display = 'none';
      } else {
        adminArea.style.display = 'none';
        signInBtn.style.display = 'inline-block';
      }
    });

    document.getElementById('adm_signOut').addEventListener('click', ()=> auth.signOut());